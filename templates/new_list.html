{% extends 'base.html' %}
{% block title %}
List page
{% endblock %}
{% block content %}

<style>
  .container {
    display: flex;
    justify-content: flex-start;
    align-items: flex-start;
    height: 100vh;
  }

  .table td,
  .table th {
    border: 1px solid white;
  }

  .mark-square {
    width: 30px;
    height: 30px;
    cursor: pointer;
    background-color: rgb(255, 255, 255);
    border-radius: 4px;
    /* This line rounds the corners */
  }

  .marked td {
    position: relative;
  }

  .marked td::after {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: #343a40;
    transform: translateY(-50%);
  }
</style>
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const squares = document.querySelectorAll(".mark-square");

    squares.forEach(square => {
      square.addEventListener("click", function () {
        const row = this.closest("tr");
        row.classList.toggle("marked");
      });
    });
  });

</script>
<div class="container">
  <form action="/new_list" method="post">
    <table class="table table-bordered table-dark">
      <thead>
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>MARK</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
        <tr>
          <td>{{ item.item }}</td>
          <td>{{ item.quantity }}</td>
          <td>
            <div class="mark-square"></div>
          </td>
        </tr>
        {% endfor %}
        <!-- Adding a new row with a mark-square at the beginning -->
        <tr>
          <td><input class="data-input" type="text" name="item"></td>
          <td><input class="data-input" type="text" name="quantity"></td>
          <td>
            <div class="mark-square"></div>
          </td>
        </tr>
      </tbody>
    </table>
    <button class="add-row-button">Add Row</button>
    <button type="submit" class="finish-button">Finish</button>
  </form>
</div>
<style>
  body {
    background-color: #212121;
    color: white;
  }

  .container {
    width: 60%;
    margin-top: 50px;
  }

  .table td,
  .table th {
    border: 1px solid white;
  }

  .marked {
    background-color: #343a40;
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const container = document.querySelector(".container");
    const addRowButton = document.querySelector(".add-row-button");
    const finishButton = document.querySelector(".finish-button");
    const tableBody = container.querySelector("tbody");

    addRowButton.addEventListener("click", function (event) {
      event.preventDefault();
      const newRow = createEmptyRow();
      tableBody.appendChild(newRow);
    });

    function createEmptyRow() {
      const newRow = document.createElement("tr");
      newRow.innerHTML = `
                <td><input class="data-input" type="text" name="item"></td>
                <td><input class="data-input" type="text" name="quantity"></td>
                <td><div class="mark-square"></div></td>
            `;
      return newRow;
    }

    finishButton.addEventListener("click", function () {
      const user = "{{ user.username }}";  // Get the username from the template context
      const dataRows = document.querySelectorAll("tbody tr"); // Select all rows within tbody
      const formData = [];

      
      dataRows.forEach((row, index) => {
        console.log(`Processing row ${index + 1}`);
        const itemInput = row.querySelector("input[name='item']");
        const quantityInput = row.querySelector("input[name='quantity']");

        if (itemInput && quantityInput) {
          const item = itemInput.value;
          const quantity = quantityInput.value;

          if (item && quantity) {
            formData.push({ item, quantity });
          }
        }
      });

      fetch("/temp_col", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          user: user,
          items: formData // Use the formData array collected from the rows
        })
      })
        .then(response => response.json())
        .then(data => {
          console.log(data);  // Handle the response from the server if needed
        })
        .catch(error => {
          console.error("Error:", error);
        });
    });

  });
</script>

{% endblock %}